{% extends "layout.html" %}
{% block content %}
<p>Total Patients: {{ count }}</p>
<p>Time to fetch details: {{ time.total_seconds() }} seconds</p>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Patient Count</th>
            <th>Percentage</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in result %}
        <tr>
            <td><a href="javascript:void(0)" class="myButton" data-entry="{{ entry }}">{{ entry['Diagnosis Name'] }}</a></td>
            <td>{{ entry["patient_count"] }}</td>
            <td>{{ entry["percentage"] }}%</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div id="chart-container">
    <canvas id="bar-chart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const chartContainer = document.getElementById("chart-container");
    const chartCanvas = document.getElementById("bar-chart");
    const ctx = chartCanvas.getContext("2d");
    let chart = null;

    function createBarChart(data) {
        if (chart) {
            chart.destroy();
        }

        chart = new Chart(ctx, {
            type: "bar",
            data: data,
        });
    }

    // Function to handle button click
    function handleButtonClick(event) {
        const clickedButton = event.target;
        const entryData = JSON.parse(clickedButton.getAttribute("data-entry").split("'").join('"'));

        const data = {
            labels: [entryData["Diagnosis Name"]],
            datasets: [
                {
                    label: "Patient Count",
                    data: [entryData["patient_count"]],
                    backgroundColor: "rgba(255, 99, 132, 0.5)",
                },
            ],
        };

        createBarChart(data);
    }

    const buttons = document.querySelectorAll(".myButton");

    buttons.forEach((button) => {
        button.addEventListener("click", handleButtonClick);
    });
</script>

{% endblock %}
